<!-- 店舗詳細ページ -->
<div class="shop-show">
  <h1 class="shop-name/s/s"><%= @shop.name %></h1>
  <% avg = @shop.reviews.average(:rating) %>
<% count = @shop.reviews.count %>
<% rounded = avg ? avg.to_f.round : 0 %>
  <div class="shop-rating2">
    <% if count > 0 %>
     <span class="stars"><%= "★" * rounded %><%= "☆" * (5 - rounded) %></span>
<span class="avg"><%= avg ? format("%.1f", avg.to_f) : "0.0" %></span>
<span class="count">（<%= count %>件）</span>
    <% else %>
      <span class="no-review">評価なし（0件）</span>
    <% end %>
</div>
  <!-- 上段：写真＋店舗情報 -->
  <div class="shop-main">
    <!-- 左：写真 -->
    <div class="shop-photos">
      <h2>建物の写真</h2>
      <% if @shop.building_photo.attached? %>
        <%= image_tag @shop.building_photo, class: "main-photo" %>
      <% else %>
        <p>未登録</p>
      <% end %>

      <h2>メニュー写真</h2>
      <div class="menu-photos">
        <% if @shop.menu_photos.attached? %>
          <% @shop.menu_photos.each do |photo| %>
            <%= image_tag photo, class: "menu-photo" %>
          <% end %>
        <% else %>
          <p>未登録</p>
        <% end %>
      </div>
    </div>
    <div class="shop-info-card">
      <ul>
        <li><strong>住所</strong><br><%= @shop.address %></li>
        <li><strong>営業時間</strong><br><%= @shop.business_hours %></li>
        <li><strong>定休日</strong><br><%= @shop.closed_days %></li>
        <li><strong>アクセス</strong><br><%= simple_format(@shop.access) %></li>
        <li><strong>備考</strong><br><%= simple_format(@shop.notes) %></li>
      </ul>
    </div>
  </div>
  <div class="shop-description">
    <%= simple_format(@shop.description) %>
  </div>
  <div class="reviews">
    <h2>口コミ</h2>
    <%= link_to "口コミを書く", new_shop_review_path(@shop), class: "review-btn" %>

    <% @reviews.each do |r| %>
      <div class="review-card">
        <p class="review-header">
          <strong><%= r.author_name.presence || r.user&.name || "guest" %></strong>
          <span><%= stars(r.rating) %>（<%= r.rating %>）</span>
          <% if r.visit_date.present? %>
            / <%= r.visit_date %>
          <% end %>
        </p>
        <p><%= simple_format(r.body) %></p>
        <% if r.images.attached? %>
          <div class="review-images">
            <% r.images.each do |img| %>
              <%= image_tag img %>
            <% end %>
          </div>
        <% end %>
      </div>
       <% end %>
 </div>